---
title: "전송계층"
excerpt: 

categories:
  - Network
tags:
  - [tag1, tag2]

permalink: /Network/network6

toc: true
toc_sticky: true

date: 2024-12-02
last_modified_at: 2024-12-02
---

## 전송 계층의 역할

목적지에 **신뢰할 수 있는 데이터**를 전달하기 위해 필요한 계층

### 전송 계층
- 오류를 점검하는 기능
- 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능

### 연결형 통신과 비연결형 통신
전송 계층의 특징은 **신뢰성/정확성**과 **효울성**으로 구분할 수 있다.
<br/>
- **연결형 통신** : 신뢰할 수 있고 정확한 데이터를 전달하는 통신
  - 상대편과 확인해 가면서 통신하는 방식
  - TCP 프로토콜 사용
- **비연결형 통신** : 신뢰할 수 있고 정확한 데이터를 전달하는 통신
  - 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식
  - 보통 동영상을 볼 때는 비연결형 통신을 사용한다.
  - UDP 프로토콜 사용
<br/>

## TCP의 구조
**TCP헤더** : TCP로 전송할 때 붙이는 헤더
**세그먼트** : TCP헤더가 붙은 데이터

데이터를 전송하려면 먼저 연결이라는 가상의 독점 통신로를 확보해야 한다.<br/>
연결 확립 후에 데이터를 전송할 수 있다.<br/>

TCP 헤더의 코드비트 부분(107번째 비트부터 112번째 비트까지의 6비트)에는 연결의 제어 정보가 기록된다.<br/>

코드 비트는 각 비트별로 역할이 있으며 초기값은 0, 비트가 활성화되면 1이된다.
<br/>
> 연결을 확립하려면 SYN, ACK가 필요하다.
- SYN : 연결 요청
- ACK : 확인 응답

### 3-way 핸드셰이크
- 연결은 SYN, ACK를 사용하여 확립할 수 있다.
- 신뢰할 수 있는 연결을 하려면 데이터를 전송하기 전에 패킷을 교환하는데, 세 번확인한다.

예로 컴퓨터1과 컴퓨터2간의 통신을 한다고 하자.
1. 통신을 하려면 컴퓨터2에게 허가를 받아야 하므로, 먼저 컴퓨터1에서 컴퓨터2로 연결 확립 허가를 받기 위한 요청(SYN)을 보낸다.
2. 컴퓨터2는 컴퓨터1이 보낸 요청을 받은 후에 허가한다는 응답을 회신하기 위해 연결 확립 응답(ACK)를 보낸다. 동시에 컴퓨터2도 컴퓨터1에게 데이터 전송 허가를 받기 위해 연결 확립 요청(SYN)을 보낸다.
3. 컴퓨터2의 요청을 받은 컴퓨터1은 컴퓨터2로 허가한다는 응답으로 연결 확립 응답(ACK)을 보낸다.

이처럼 데이터를 보내기 전에 연결을 확립하기 위해 패킷 요청을 세번 교환하는 것을 **3-way 핸드셰이크**라고 한다.
<br/>
데이터를 전송한 후에는 연결을 끊기 위한 요청을 교환해야 한다.
> 연결을 끊을 때는 FIN, ACK를 사용한다.
- FIN : 연결 종료

1. 컴퓨터1에서 컴퓨터2로 연결 종료 요청(FIN)을 보낸다.
2. 컴퓨터2에서 컴퓨터1로 연결 종료 응답(ACK)을 반환한다.
3. 또한 컴퓨터2에서도 컴퓨터1로 연결 종료 요청을 보낸다.
4. 컴퓨터1에서 컴퓨터2로 연결 종료 응답을 반환한다.

## 일련변호와 확인 응답 번호의 구조
3way-handshake가 끝나고 실제 데이터를 보내거나 상대방이 받을 때는 TCP 헤더의 일련번호와 확인 응답 번호를 사용한다.

**일련번호** : 송신 측에서 수신 측에 '이 데이터가 몇 번째 데이터인지' 알려 주는 역할
전송된 데이터에 일련번호를 부여하면 수신자는 원래 데이터의 몇 번째 데이터를 받았는지 알 수 있다.

**확인 응답 번호** : 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할, 다음 번호의 데이터를 요청하는 데도 사용.<br/>
**재전송 제어** : 데이터가 항상 올바르게 전달되는 것이 아니므로 일련번호와 확인 응답 번호를 사용해서 데이터가 손상되거나 유실된 경우에 데이터를 재전송하는 것.

### 윈도우 크기
**세그먼트(데이터)** 하나를 보낼 때마다 확인 응답을 한 번 반환하는 통신, 효율이 낮다.
효율을 높이기 위해서 세그먼트를 연속해서 보내고 난 다음 확인 응답을 반환하는 방식을 사용. <br/>
**버퍼**: 받은 세그먼트를 일시적으로 보관하는 장소 <br/>
**오버플로우** : 수신 측은 대량으로 데이터가 전송되면 보관하지 못하고 넘쳐 버린다. <br/>
오버플로가 발생하지 않도록 버퍼의 한계크기를 알고 있어야 한다.
TCP 헤더의 윈도우 크기값에 해당.
<br/>
> 윈도우 크기는 얼마나 많은 용량의 데이터를 저장할 수 있는지를 나타낸다.
즉, 확인 응답을 일일이 하지 않고 연속해서 송수신할 수 있는 크기.
<br/>
윈도우 크기의 초기값은 3-way 핸드셰이크를 할 때 판단한다. 

## 포트 번호의 구조
**포트 번호**: 전송된 데이터의 목적지가 어떤 애플리케이션인지 구분하는 역할을 한다.
TCP헤더의 출발지 포트 번호와 목적지 포트 번호가 필요하다.
<br/>
- 잘 알려진 포트 : 0~1023번 포트는 주요 프로토콜이 사용하고록 예약되어 있다.
- 예약되어 있지만 사용되지는 않는 포트 : 1024번 포트
- 랜덤 포트 : 1025번 이상, 클라이언트 측의 송신 포트로 사용

동작하는 애플리케이션은 각각 포트 번호가 있어서 다른 애플리케이션과 서로 구분된다.<br/>
데이터를 전송할 때는 상대방의 IP 주소가 필요하지만, 어떤 애플리케이션이 사용되고 있는지 구분하려면 TCP는 포트 번호가 필요하다.

## UDP의 구조
UDP는 비연결형 통신, TCP와 달리 효율성을 중요하게 여기는 프로토콜.
- 장점: 데이터를 효율적으로 빠르게 보내는 것
UDP 헤더가 붙은 데이터를 UDP 데이터그램이라고 한다.<br/>
**브로드캐스트**: UDP를 사용하여 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보내는 것 (불특정 다수)






